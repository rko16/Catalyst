chrome.runtime.onMessage.addListener((a,i,t)=>{if(a.action==="call_openai")return chrome.storage.local.get("openai_api_key",async s=>{const r=s.openai_api_key;if(!r){t({error:"No API key set"});return}try{const o={model:"gpt-3.5-turbo",messages:[{role:"system",content:"You are Catalyst Assistant. Keep responses short and kind."},{role:"user",content:a.prompt}]},e=await(await fetch("https://api.openai.com/v1/chat/completions",{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer "+r},body:JSON.stringify(o)})).json(),n=e.choices&&e.choices[0]&&e.choices[0].message?e.choices[0].message.content:JSON.stringify(e);t({text:n})}catch(o){t({error:o.toString()})}}),!0});
